<!doctype html>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=8">
	<meta name="keywords" content=""/>
	<title>后台管理</title>
	{include /public/global_css}
</head>
  	<body>
	<div id="console-content-index-index">
		<div class="view-content-container" >
			<div class="row">
				<div class="col-sm-12">
					<div class="console-title console-title-border clearfix">
						<div class="pull-left">
							<h5>菜单列表</h5>
						</div>
						<div class="pull-right">
							<a class="btn btn-primary btn-open" config-href="{F:url('edit',array('parentid'=>$parentid))}"  config-height="500px" config-width="60%">添加分类</a>
							
							
							<a class="btn btn-primary btn-files-none" config-name="xls_import" config-url="{F:url('import')}">
								批量导入
							</a>
							<input type="file" style="display:none;" name="xls_import" multiple="multiple">	
						

							{if in_array('en',$this->lg)}
								<a class="btn btn-primary btn-trans" config-href="{F:url('edit')}" data-parentid="{$parentid}" config-tips="该操作会覆盖原字段信息,请谨慎操作!">生成英文</a>
							{/if}

							{if in_array('jp',$this->lg)}
								<a class="btn btn-primary btn-trans" config-href="{F:url('edit')}" data-parentid="{$parentid}" config-tips="该操作会覆盖原字段信息,请谨慎操作!">生成日文</a>
							{/if}
						</div>
					</div>
					<form class="form-inline ng-pristine ng-valid" action=""  method="get">
                        <div class="form-group">
                            <select class="form-control" name="field">
                                <option value="title">标题</option>
                            </select>
                            <input type="text" class="form-control w120" placeholder="Search" name="keyword" value="{??$param['keyword']}" >
                            <button type="submit" class="btn btn-default" >搜索</button>
                        </div>
                    </form>
					<div class="console-form">
						<div class="mt8">
							<form>
								<table class="table table-hover">
									<thead>
										<tr>
											<th style="width:75px;">ID</th>
											<th>标题</th>
											<th style="width:120px;">状态</th>
											<th style="width:180px; text-align:center;">编辑/操作</th>
										</tr>
									</thead>
									<tbody>
										{loop $list $key $value}
									 	<tr v-for="list in list">
											<td>{$value['id']}</td>
											<td>{$value['name']}</td>
											<td>{$value['is_show']}</td>
											<td align='center'>
												<a config-href="{F:url('edit',array('parentid'=>$value['id']))}"  config-height="500px" config-width="60%"  config-title="编辑分类"  class="btn-open">添加子类</a>
												<a href="{F:url('lists',array('id'=>$value['id']))}">查看子类</a>
												<a config-href="{F:url('edit',array('id'=>$value['id']))}"  config-height="500px" config-width="60%"  config-title="编辑分类"  class="btn-open">编辑</a>
												<a config-href="{F:url('del')}" config-tips="确定删除【{$value['name']}】分类?" data-id="{$value['id']}" class="btn-ajax-post">删除</a>
											</td>
										</tr>
										{/loop}
									</tbody>
									<page :pages="pages" v-on:getPages="getPages"></page>
								</table>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	{include /public/global_js}
	<script type="text/javascript">
	$('.btn-trans').click(function(){
		var tips = $(['config-tips']);
	})

	$('.btn-files-none').click(function(){
		let name     = $(this).attr('config-name');
		let event  	 = $('input[name="'+name+'"]');
		let url      = $(this).attr('config-url');

		if(!url){
			return layer.msg('请求Url不能为空');
		}

	 	event.wrap('<form>').closest('form').get(0).reset();
		event.trigger('click');

		event.change(function(e){
			let _this = this;
			//进度条
			let progress = '<div class="progress" style="margin:0px; margin-top:5px;"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 1%;">1%</div></div>';
	        //获取资源
	        let files = e.target.files || e.dataTransfer.files;
	        //资源赋值
	        let formData = new FormData();
	        formData.append('file', files[0]);

	        //ajax异步上传  
	        $.ajax({  
	            url : url,  
	            type: 'POST',  
	            data: formData,
	            dataType: 'json',  
	            contentType: false, //必须false才会自动加上正确的Content-Type  
	            processData: false,  //必须false才会避开jQuery对 formdata 的默认处理  
	            xhr: function(){ //获取ajaxSettings中的xhr对象，为它的upload属性绑定progress事件的处理函数
	                //移除之前的上传进度条
	                $(_this).parent().find('.progress').remove();
	                //添加现在的进度条
	                layer.alert(progress);  
	                myXhr = $.ajaxSettings.xhr();  
	                if(myXhr.upload){ 
	                    myXhr.upload.addEventListener('progress',progressHandlingFunction, false);   
	                }  
	                return myXhr; 
	            },  
	            success: function(result){
	                return layer.msg(result.msg);               
	            },  
	        }); 


	        //上传进度回调函数：  
	        function progressHandlingFunction(e) {
	            if (e.lengthComputable) {  
	                $('progress').attr({value : e.loaded, max : e.total}); //更新数据到进度条  
	                var percent = parseInt(e.loaded/e.total*100); 
	                $('.progress-bar').css('width',percent+'%');
	                $('.progress-bar').text(percent+'%'); 
	            }  
	        }  
	    });
	})

	</script>
</body>
</html>